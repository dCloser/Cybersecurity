let threshold = 10;
Syslog
| where SyslogMessage has 'malware'
| extend src= extract("(([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})\\.(([0-9]{1,3})))",0,SyslogMessage) 
| extend suser= extract (@"(\w+)=([^=\s]+)(?:\s|$)", 0,SyslogMessage)
| summarize Denials= count(src) by suser, bin(TimeGenerated, 10m)



let threshold = 10;
PaloAltoCDLEvent
| where EventResourceId =~ 'TRAFFIC'
| where isnotempty(DstPortNumber) and isnotempty(SrcIpAddr)
| summarize PortSet = make_set(DstPortNumber) by SrcIpAddr, bin(TimeGenerated, 5m)
| where array_length(PortSet) > threshold
| extend IPCustomEntity = SrcIpAddr


extract(@'date=(\S+)', 1, SyslogMessage),
Src_IP = extract(@'src_ip=\"?([\w\.]+)\"?', 1, SyslogMessage)
Src_Country_Code = extract(@'(src_country|src_country_code)=\"?(\w+)\"?', 2, SyslogMessage)
Dst_MAC = extract(@'dst_mac=\"?([\w\:]+)\"?', 1, SyslogMessage),
Dst_IP = extract(@'dst_ip=\"?([\w\.]+)\"?', 1, SyslogMessage),
Dst_Country_Code = extract(@'(dst_country|dst_country_code)=\"?(\w+)\"?', 2, SyslogMessage),
Protocol = extract(@'protocol=\"?(\w+)\"?', 1, SyslogMessage),
Src_Port = extract(@'src_port=\"?(\d+)\"?', 1, SyslogMessage),
Dst_Port = extract(@'dst_port=\"?(\d+)\"?', 1, SyslogMessage),
Tran_Src_IP = extract(@'(src_trans_ip|tran_src_ip)=(\S+)', 2, SyslogMessage),
Tran_Src_Port = extract(@'(src_trans_port|tran_src_port)=\"?(\d+)\"?', 2, SyslogMessage),
Tran_Dst_IP = extract(@'(dst_trans_ip|tran_dst_ip)=(\S+)', 2, SyslogMessage),
Tran_Dst_Port = extract(@'(dst_trans_port|tran_dst_port)=\"?(\d+)\"?', 2, SyslogMessage),